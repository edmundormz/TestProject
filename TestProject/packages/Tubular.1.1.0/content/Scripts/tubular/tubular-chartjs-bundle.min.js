(function(n){"use strict";n.module("tubular-chart.directives",["tubular.services","chart.js"]).component("tbChartjs",{template:'<div class="tubular-chart"><canvas class="chart chart-base" chart-type="$ctrl.chartType" chart-data="$ctrl.data" chart-labels="$ctrl.labels"  chart-series="$ctrl.series" chart-click="$ctrl.onClick" chart-options="$ctrl.options"><\/canvas><ul ng-show="$ctrl.showLegend" class="pie-legend"><li ng-repeat="item in $ctrl.legends"><span style="background-color: {{item.color}}"><\/span>{{item.label}}<\/li><\/ul><div class="alert alert-info" ng-show="$ctrl.isEmpty">{{$ctrl.emptyMessage}}<\/div><div class="alert alert-warning" ng-show="$ctrl.hasError">{{$ctrl.errorMessage}}<\/div><\/div>',bindings:{serverUrl:"@",requireAuthentication:"=?",showLegend:"@?",name:"@?chartName",chartType:"@?",emptyMessage:"@?",errorMessage:"@?",onLoad:"=?",onClick:"=?",data:"=?",labels:"=?",series:"=?",options:"=?"},controller:["$scope","tubularHttp",function(t,i){var r=this;r.dataService=i.getDataService(r.dataServiceName);r.showLegend=n.isUndefined(r.showLegend)?!0:r.showLegend;r.chartType=r.chartType||"line";r.requireAuthentication=n.isUndefined(r.requireAuthentication)?!0:r.requireAuthentication;r.loadData=function(){i.setRequireAuthentication(r.requireAuthentication);i.get(r.serverUrl).promise.then(function(n){if(!n||!n.Data||n.Data.length===0){if(r.isEmpty=!0,r.options||(r.options={}),r.options.series=[{data:[]}],r.onLoad)r.onLoad(r.options,{});return}if(r.isEmpty=!1,r.data=n.Data,r.series=n.Series,r.labels=n.Labels,r.onLoad)r.onLoad(r.options,n)},function(n){t.$emit("tbChart_OnConnectionError",n)})};t.$watch("$ctrl.serverUrl",function(t){n.isDefined(t)&&t!=null&&r.loadData()});t.$on("chart-create",function(n,t){r.legends=r.chartType=="pie"||r.chartType=="doughnut"?t.chart.config.data.labels.map(function(n,i){return{label:n,color:t.chart.config.data.datasets[0].backgroundColor[i]}}):t.chart.config.data.datasets.map(function(n){return{label:n.label,color:n.borderColor}})})}]})})(window.angular),function(n){"use strict";if(typeof exports=="object")module.exports=n(typeof angular!="undefined"?angular:require("angular"),typeof Chart!="undefined"?Chart:require("chart.js"));else if(typeof define=="function"&&define.amd)define(["angular","chart"],n);else{if(typeof angular=="undefined"||typeof Chart=="undefined")throw new Error("Chart.js library needs to included, see http://jtblin.github.io/angular-chart.js/");n(angular,Chart)}}(function(n,t){"use strict";function r(){var i={},r={Chart:t,getOptions:function(t){var r=t&&i[t]||{};return n.extend({},i,r)}};this.setOptions=function(t,r){if(!r){r=t;i=n.extend(i,r);return}i[t]=n.extend(i[t]||{},r)};this.$get=function(){return r}}function u(r,u){function a(n,t){return n&&t&&n.length&&t.length?Array.isArray(n[0])?n.length===t.length&&n.every(function(n,i){return n.length===t[i].length}):t.reduce(v,0)>0?n.length===t.length:!1:!1}function v(n,t){return n+t}function s(t,i,r,u){var f=null;return function(e){var s=i.getElementsAtEvent||i.getPointsAtEvent,o;s&&(o=s.call(i,e),(u===!1||n.equals(f,o)===!1)&&(f=o,t[r](o,e)))}}function y(i,u){for(var f=n.copy(u.chartColors||r.getOptions(i).chartColors||t.defaults.global.colors),e=f.length<u.chartData.length;f.length<u.chartData.length;)f.push(u.chartGetColor());return e&&(u.chartColors=f),f.map(p)}function p(n){return typeof n=="object"&&n!==null?n:typeof n=="string"&&n[0]==="#"?c(w(n.substr(1))):h()}function h(){var n=[e(0,255),e(0,255),e(0,255)];return c(n)}function c(n){return{backgroundColor:f(n,.2),borderColor:f(n,1),pointBackgroundColor:f(n,1),pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:f(n,.8)}}function e(n,t){return Math.floor(Math.random()*(t-n+1))+n}function f(n,t){return i?"rgb("+n.join(",")+")":"rgba("+n.concat(t).join(",")+")"}function w(n){var t=parseInt(n,16),i=t>>16&255,r=t>>8&255,u=t&255;return[i,r,u]}function b(t,i,r,u,f){return{labels:t,datasets:i.map(function(t,i){var e=n.extend({},u[i],{label:r[i],data:t});return f&&(e.yAxisID=f[i]),e})}}function k(n,t,i){return{labels:n,datasets:[{data:t,backgroundColor:i.map(function(n){return n.pointBackgroundColor}),hoverBackgroundColor:i.map(function(n){return n.backgroundColor})}]}}function d(n,t,i){Array.isArray(i.chartData[0])?n.data.datasets.forEach(function(n,i){n.data=t[i]}):n.data.datasets[0].data=t;n.update();i.$emit("chart-update",n)}function l(n){return!n||Array.isArray(n)&&!n.length||typeof n=="object"&&!Object.keys(n).length}function g(i,u){var f=n.extend({},t.defaults.global,r.getOptions(i),u.chartOptions);return f.responsive}function o(n,t){n&&(n.destroy(),t.$emit("chart-destroy",n))}return function(t){return{restrict:"CA",scope:{chartGetColor:"=?",chartType:"=",chartData:"=?",chartLabels:"=?",chartOptions:"=?",chartSeries:"=?",chartColors:"=?",chartClick:"=?",chartHover:"=?",chartYAxes:"=?"},link:function(f,e){function v(i,r){if(!l(i)&&!n.equals(i,r)){var u=t||f.chartType;u&&p(u)}}function p(t){if(g(t,f)&&e[0].clientHeight===0)return u(function(){p(t)},50,!1);if(f.chartData&&f.chartData.length){f.chartGetColor=typeof f.chartGetColor=="function"?f.chartGetColor:h;var l=y(t,f),i=e[0],a=i.getContext("2d"),v=Array.isArray(f.chartData[0])?b(f.chartLabels,f.chartData,f.chartSeries||[],l,f.chartYAxes):k(f.chartLabels,f.chartData,l),w=n.extend({},r.getOptions(t),f.chartOptions);o(c,f);c=new r.Chart(a,{type:t,data:v,options:w});f.$emit("chart-create",c);i.onclick=f.chartClick?s(f,c,"chartClick",!1):n.noop;i.onmousemove=f.chartHover?s(f,c,"chartHover",!0):n.noop}}var c;i&&window.G_vmlCanvasManager.initElement(e[0]);f.$watch("chartData",function(n,i){if(!n||!n.length||Array.isArray(n[0])&&!n[0].length){o(c,f);return}var r=t||f.chartType;if(r){if(c&&a(n,i))return d(c,n,f);p(r)}},!0);f.$watch("chartSeries",v,!0);f.$watch("chartLabels",v,!0);f.$watch("chartOptions",v,!0);f.$watch("chartColors",v,!0);f.$watch("chartType",function(t,i){l(t)||n.equals(t,i)||p(t)});f.$on("$destroy",function(){o(c,f)})}}}}t.defaults.global.multiTooltipTemplate="<%if (datasetLabel){%><%=datasetLabel%>: <%}%><%= value %>";t.defaults.global.elements.line.borderWidth=2;t.defaults.global.elements.rectangle.borderWidth=2;t.defaults.global.legend.display=!1;t.defaults.global.colors=["#97BBCD","#DCDCDC","#F7464A","#46BFBD","#FDB45C","#949FB1","#4D5360"];var i=typeof G_vmlCanvasManager=="object"&&window.G_vmlCanvasManager!==null&&typeof window.G_vmlCanvasManager.initElement=="function";return i&&(t.defaults.global.animation=!1),n.module("chart.js",[]).provider("ChartJs",r).factory("ChartJsFactory",["ChartJs","$timeout",u]).directive("chartBase",["ChartJsFactory",function(n){return new n}]).directive("chartLine",["ChartJsFactory",function(n){return new n("line")}]).directive("chartBar",["ChartJsFactory",function(n){return new n("bar")}]).directive("chartRadar",["ChartJsFactory",function(n){return new n("radar")}]).directive("chartDoughnut",["ChartJsFactory",function(n){return new n("doughnut")}]).directive("chartPie",["ChartJsFactory",function(n){return new n("pie")}]).directive("chartPolarArea",["ChartJsFactory",function(n){return new n("polarArea")}])});